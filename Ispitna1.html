<!DOCTYPE html>
<html lang="mk">
<head>
    <meta charset="UTF-8">
    <title>Игрица – Правоаголници</title>
    <style>
        #container {
            width: 800px;
            height: 600px;
            border: 1px solid #000;
            display: inline-block;
            position: relative;
            overflow: hidden;
        }
        p {
            display: inline-block;
            vertical-align: top;
            margin-left: 15px;
            font-weight: bold;
            font-size: 18px;
        }
        .rectangle {
            position: absolute;
            display: inline-block;
            border: 1px solid #000;
        }
        .line {
            position: absolute;
            top: 0;
            height: 600px;
            width: 3px;
            background: #000;
        }
        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 40px;
            font-weight: bold;
            color: red;
            display: none;
        }
    </style>
</head>
<body>
<div id="container">
    <div id="gameOver">GAME OVER</div>
</div>
<p>Поени: <span id="score">0</span></p>

<script>
    let n_line = 0, score = 0, counter = 0;

    // JSON STRING пример
    let jsonString = '[{"id":"1","dir":"vertical","width":"87px","height":"43px","score":52,"left":50,"top":180},'+
        '{"id":"2","dir":"horizontal","width":"112px","height":"48px","score":2,"left":140,"top":250},'+
        '{"id":"3","dir":"vertical","width":"47px","height":"97px","score":37,"left":560,"top":380},'+
        '{"id":"4","dir":"vertical","width":"71px","height":"71px","score":150,"left":450,"top":350},'+
        '{"id":"5","dir":"horizontal","width":"76px","height":"95px","score":24,"left":650,"top":15},'+
        '{"id":"6","dir":"vertical","width":"100px","height":"132px","score":73,"left":200,"top":70}]';

    let data = JSON.parse(jsonString);

    // креирај правоаголници
    data.forEach((d,i)=>{
        let colors = ["red","green","blue","orange","purple","pink","cyan"];
        let randomColor = colors[Math.floor(Math.random()*colors.length)];
        let rect = "<div id='"+d.id+"' class='rectangle' " +
            "style='width:"+d.width+";height:"+d.height+";background:"+randomColor+";" +
            "left:"+d.left+"px;top:"+d.top+"px;' " +
            "score='"+d.score+"' dir='"+d.dir+"' current='"+(i%2)+"'></div>";
        document.getElementById("container").innerHTML += rect;
    });

    // старт
    start_moving();

    function start_moving() {
        counter++;
        document.querySelectorAll(".rectangle").forEach(obj => {
            if (obj.getAttribute("dir") === "vertical") {
                let top = obj.offsetTop;
                if (obj.getAttribute("current") === "0") {
                    top -= 5; if (top <= 0) obj.setAttribute("current","1");
                } else {
                    top += 5; if (top + obj.offsetHeight >= 600) obj.setAttribute("current","0");
                }
                obj.style.top = top + "px";
            } else {
                let left = obj.offsetLeft;
                if (obj.getAttribute("current") === "0") {
                    left += 5; if (left + obj.offsetWidth >= 800) obj.setAttribute("current","1");
                } else {
                    left -= 5; if (left <= 0) obj.setAttribute("current","0");
                }
                obj.style.left = left + "px";
            }
        });

        if (n_line >= 3) return; // ако веќе има 3 линии -> стоп

        if (counter < 50) {
            setTimeout(start_moving, 50);
        } else {
            counter = 0;
            flash_the_line();
        }
    }

    function flash_the_line() {
        n_line++;
        const line_pos = Math.floor(Math.random() * 800); // СЛУЧАЕН ИЗБОР
        const line_colors = ["black","red","blue","green","purple"];
        const randomLineColor = line_colors[Math.floor(Math.random() * line_colors.length)];
        const line = "<div class='line' style='left:" + line_pos + "px;background:"+randomLineColor+";'></div>";
        document.getElementById("container").innerHTML += line;

        document.querySelectorAll(".rectangle").forEach(obj => {
            const start = obj.offsetLeft;
            const end = start + obj.offsetWidth;
            if (line_pos >= start && line_pos <= end) {
                score += parseInt(obj.getAttribute("score"),10);
                obj.style.display = "none";
                obj.setAttribute("score","0");
            }
        });

        document.getElementById("score").textContent = score;

        if (n_line < 3) {
            setTimeout(clear_lines, 1000);
        } else {
            setTimeout(end_game, 1000);
        }
    }

    function clear_lines(){
        document.querySelectorAll(".line").forEach(l=>l.remove());
        start_moving();
    }

    function end_game(){
        document.querySelectorAll(".line").forEach(l=>l.remove());
        document.getElementById("gameOver").style.display="block";
    }
</script>
</body>
</html>
